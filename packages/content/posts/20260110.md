---
title: 'CSS Layout Testing  というテスト手法の提案'
publishedAt: '2026-01-10'
summary: 'Web のフロントエンド実装において、次のようなミスによってデザイン崩れを起こしてしまったことはありませんか。 flex-shrink の指定を忘れて、要素が押しつぶされてしまった z-index の指定を間違えて、要素が意図せず前面（また'
tags: []
index: false
---

Web のフロントエンド実装において、次のようなミスによってデザイン崩れを起こしてしまったことはありませんか。

- `flex-shrink` の指定を忘れて、要素が押しつぶされてしまった
- `z-index` の指定を間違えて、要素が意図せず前面（または背面）に表示されてしまった
- `object-fit` の指定を間違えて、画像の一部が欠損してしまった

これらのデザイン崩れは、実装中に気づくこともあれば、リリース後に初めて気づいてしまうこともあります。  
本記事では、このようなデザイン崩れについて、テストコードによって発生しないことを担保できないかと考え、その可能性を整理します。  
なお、本記事にはサンプルコードは含まれていません。

## デザイン崩れをチェックするアドオン

データ増減によるデザイン崩れを発見しやすくするため、私は次の Storybook アドオンを開発しました。

https://www.npmjs.com/package/storybook-addon-range-controls

このアドオンを使うことで、数値や配列などの Props に対して、スライダー UI を用いて簡単にデータを増減させることができます。  
コンポーネントに対して、想定より多い・少ないデータを与えながら表示を確認できる点で、便利なツールです。

一方で、この確認作業は最終的に人の目によるチェックに依存しており、「デザインが崩れていないこと」を仕組みとして保証できているわけではありません。

## CSS Layout Testing

こうしたデザイン崩れに対して、テストコードを書くことで問題を防げないかと考えました。  
そこで、次のような方法で、レイアウトに関するテスト、CSS Layout Testing を構築できるのではないかと思います。

1. Vitest Browser Mode を利用し、Playwright 上でテストを書く
    - JSDOM のような仮想 DOM ではなく、実際のブラウザ上で動かすことが重要です
1. テストコード内で Web API を使い、レイアウトが崩れていないかを検証する
    - `getBoundingClientRect`: 要素の表示位置や横幅・縦幅を取得できる
    - `elementFromPoint`: 指定した位置において、最前面に描画されている要素を取得できる
    - そのほか、必要に応じた API

例えば、「`flex-shrink`の指定を忘れて、要素が押しつぶされてしまった」というケースであれば、
対象となる要素の横幅や縦幅を `getBoundingClientRect` で取得し、一定以上のサイズを保っていることを検証する、といったテストが考えられます。

また、「`z-index`の指定を間違えて、要素が意図せず前面（または背面）に表示されてしまった」というケースでは、該当箇所まで移動した上で、特定の X 軸・Y 軸に対して`elementFromPoint` を実行し、取得された要素が意図する要素であることを検証する、といったテストが書けそうです。

これらの問題は、CSS Lint の設定によって防げる場合もありますし、Visual Regression Testing（VRT）によって検出できる場合もあります。ただし、Lint ではすべてのデザイン崩れを拾えるわけではありませんし、VRT についても、画像ファイルの管理や実行時間の増加などの制約があります。

## おわりに

サンプルコードを用意しようかと思ったのですが、都合により準備することができませんでした。時間があれば、試してみたいと思います。
